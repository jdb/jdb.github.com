<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ssh &mdash; fiches v0.1 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="fiches v0.1 documentation" href="index.html" />
    <link rel="next" title="lvm" href="lvm.html" />
    <link rel="prev" title="debian package and repositories" href="packaging.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="lvm.html" title="lvm"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="packaging.html" title="debian package and repositories"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">fiches v0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="ssh">
<h1>ssh<a class="headerlink" href="#ssh" title="Permalink to this headline">¶</a></h1>
<div class="section" id="x11-forwarding">
<h2>X11 forwarding<a class="headerlink" href="#x11-forwarding" title="Permalink to this headline">¶</a></h2>
<p>In Debian and Ubuntu, if there is a need to use a graphical
application on a server with no display, it is possible to run the
application there and the window showing on the local display.</p>
<p>With the default configuration on etch and lenny, the server is
already correctly configured with X11Forwarding set to &#8216;yes&#8217;</p>
<ol class="arabic simple">
<li>install xbase-clients on the remote machine</li>
<li>connect using ssh -X to the remote machine and launch the
application from there;</li>
</ol>
<p class="rubric">forwarding without ssh</p>
<p>Note: it is a security risk since the input and output are not encrypted</p>
<ol class="arabic simple">
<li>get rid of the &#8216;-nolisten tcp&#8217; option on the local X server in the
gdm configuration. In Gnome, it is in <em>System &gt; Administration &gt;
Login Window</em>, in the security section.</li>
<li>On the local system, I set &#8216;xhost +&#8217;.</li>
<li>Also on the local system, &#8216;echo $DISPLAY&#8217; shows :0.0, so on the
remote server: &#8216;export DISPLAY=192.168.0.2:0.0&#8217; where 192.168.0.2
is the local machine with the X server.</li>
</ol>
</div>
<div class="section" id="client-preferences">
<h2>Client preferences<a class="headerlink" href="#client-preferences" title="Permalink to this headline">¶</a></h2>
<p>The preferences file it at <tt class="docutils literal"><span class="pre">~/.ssh/ssh_config</span></tt>. These options take
precedence on the default options in  <tt class="docutils literal"><span class="pre">/etc/ssh/ssh_config</span></tt></p>
<p>A while ago point, the login to a server would take 5/10 secondes, and
commenting these two options would take care of the problem</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#    GSSAPIAuthentication yes</span>
</pre></div>
</div>
</div>
<div class="section" id="passwordless-ssh-access">
<h2>Passwordless ssh access<a class="headerlink" href="#passwordless-ssh-access" title="Permalink to this headline">¶</a></h2>
<p>When you want a passwordless access to a remote ssh server:</p>
<div class="highlight-python"><pre>ssh-copy-id alice@remote_server</pre>
</div>
<p>You will have to type your password one last time, and voila</p>
<p>What <tt class="docutils literal"><span class="pre">ssh-copy-id</span></tt> does is just append your public key to the remote
file <tt class="docutils literal"><span class="pre">/home/alice/.ssh/authorized_keys</span></tt>:: .</p>
</div>
<div class="section" id="the-ssh-client-detects-man-in-the-middle-attacks">
<h2>The ssh client detects man-in-the-middle attacks<a class="headerlink" href="#the-ssh-client-detects-man-in-the-middle-attacks" title="Permalink to this headline">¶</a></h2>
<p>When a server refuse the ssh connexion with a warning about a
<em>man-in-the-middle attack</em>, there are good chances that it is because
the server displays a server key different from the server key which
was displayed before for this host. ssh keeps the server keys in
<tt class="docutils literal"><span class="pre">~/.ssh/known_hosts</span></tt>. The problem arise when a virtual machine is
reinstalled a virtual machine with the same name.</p>
<p>The warning message says for example, <tt class="docutils literal"><span class="pre">Offending</span> <span class="pre">key</span>
<span class="pre">~/.ssh/known_hosts:27</span></tt>. If you are sure that you want to connect,
just use</p>
<div class="highlight-python"><pre>sed -i 27d ~/.ssh/known_hosts</pre>
</div>
<p>ssh asks to put new server keys in the known hosts lists, the ssh
client will do it automatically if the option
<tt class="docutils literal"><span class="pre">StrictHostKeyChecking</span></tt> is set to no.</p>
<p>Il est aussi possible de changer les options de connexion du client
ssh pour eviter le &#8220;strict checking&#8221;. Dans le fichier
{{{~/.ssh/config}}} mettre l&#8217;option {{{StrictHostKeyChecking no}}}. Le
plus propre, c&#8217;est encore d&#8217;utiliser la commande {{{HostKeyAlias}}}
dans le fichier d&#8217;option:</p>
<dl class="docutils">
<dt>::</dt>
<dd><dl class="first last docutils">
<dt>Host mngmt</dt>
<dd>Port            2222
User            root
Hostname        localhost
HostKeyAlias    mngmt}}}</dd>
</dl>
</dd>
</dl>
<p>Note that, it is quite confusing for the ssh client, we tell him to
connect to localhost but when he receives a server key from that
connexion, it does not match the key called &#8216;localhost&#8217; in
{{{.ssh/known_host}}}. As you may have guessed, the server public key
comes from the management server not from localhost. With the
{{{HostKeyAlias}}} command, we can tell the ssh client to look up the
key associated to the name &#8220;mngmt&#8221; in the known_hosts file instead of
looking up the key associated with the name &#8220;localhost&#8221;.</p>
<p>From now on, you can tighten up security by getting rid of
{{{StrictHostKeyChecking no}}} because server public keys will be
correctly handled even with tunnels. You may have this message again
if you do change the public keys of the ssh server on this IP
address. Or you have a real man-in-the-middle attack going on.</p>
</div>
<div class="section" id="keepalive-from-the-client">
<h2>Keepalive from the client<a class="headerlink" href="#keepalive-from-the-client" title="Permalink to this headline">¶</a></h2>
<p>If you get disconnected from the remote server after an intervalle,
maybe it is a firewall which breaks the connexion because it decides
the connexion is inactive. In the preference file, you can add</p>
<div class="highlight-python"><pre>ServerAliveInterval 300</pre>
</div>
<p>Every 300 secondes, the client will request a short data to the
server, keeping the connexion active.</p>
</div>
<div class="section" id="ssh-port-forwarding">
<h2>SSH port forwarding<a class="headerlink" href="#ssh-port-forwarding" title="Permalink to this headline">¶</a></h2>
<p>It is commonly called &#8220;ssh tunnel&#8221; but we prefer to call it &#8220;ssh port
forwarding&#8221; as it is more precise and it helps understanding what is
possible and what is not.</p>
<p>This technique is powerful: let&#8217;s say you have web servers, SMTP
servers, LDAP servers etc waiting for you on some far away network BUT
there is a firewall that only lets ssh traffic going through between
you and one ssh server on the remote network. You will be able to use
your local email client and browser to access the remote servers
behind the firewall.</p>
<p>SSH port forwarding will work fine with <strong>TCP services toward
pre-defined servers on pre-defined tcp ports.</strong></p>
<p>You need :</p>
<ul class="simple">
<li>access to one ssh server on that remote network (openssh all the
way, no VNC or remote desktop protocol!)</li>
<li>your local client can choose the port on which to connect</li>
</ul>
<p>You can&#8217;t do :</p>
<ul class="simple">
<li>ftp because the file transfer happen on new dynamic ports new
servers</li>
<li>H323 or SIP because the &#8216;connect&#8217; packet tells the client to connect to new
ports, sometime new server.</li>
<li>HTTP redirect, your web client will not be able to follow them: use
the final url directly not the shortcut</li>
<li>UDP protocole : media, SNMP use port <strong>udp</strong>/161,162, ssh tunnel
only works with TCP</li>
</ul>
<p>Additional goodies :</p>
<blockquote>
<ul class="simple">
<li>under linux, you can declare a directory on the ssh server to be
seen as a &#8220;share&#8221; or &#8220;network directory&#8221;. For example, you can
study remote traces with your local ethereal without having to
download and store the traces.</li>
<li>in a slightly different config where the firewall only accepts
outgoing ssh connexions and not incoming connexions on the remote
network, it is still possible to connect to a webserver of the
remote network from an outside local web client. (Example: I want
to connect to the ncx intranet from my home without VPN).</li>
</ul>
</blockquote>
<div class="section" id="quick-howto">
<h3>Quick howto<a class="headerlink" href="#quick-howto" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s say you have a &#8220;hop server&#8221; called <em>bastion</em> running sshd on the
remote network, on which you can connect with the alice login. Only
from this server, you can connect with the bob login to the
<em>streamer01</em> and <em>streamer02</em> servers you are interested. This is two
hops for each server instead of one, this is inconvenient. You can use
the following for only executing one command to tget directly from
your laptop to <em>streamer01</em> or to <em>streamer02</em></p>
<div class="highlight-python"><pre># This command will not return
ssh alice@bastion -N -L 2201:streamer01:22 -L 2202:streamer02:22 -L 8080:webserver:80 &amp;

ssh -p 2201 bob@localhost     # to get to streamer01
ssh -p 2202 bob@localhost     # to get to streamer02
wget http://localhost:8080    # to make an http get to webserver</pre>
</div>
<p>It is a pain to remember the port on the bastion driving you to the
correct server, the preferences file <tt class="docutils literal"><span class="pre">~/.ssh/config</span></tt> is handy</p>
<div class="highlight-python"><pre>Host streamer01
     Port            2201
     User            bob
     Hostname        bastion

Host streamer02
     Port            2202
     User            bob
     Hostname        bastion</pre>
</div>
</div>
<div class="section" id="going-beyond-the-limitations">
<h3>Going beyond the limitations<a class="headerlink" href="#going-beyond-the-limitations" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="">ssh</a><ul>
<li><a class="reference external" href="#x11-forwarding">X11 forwarding</a></li>
<li><a class="reference external" href="#client-preferences">Client preferences</a></li>
<li><a class="reference external" href="#passwordless-ssh-access">Passwordless ssh access</a></li>
<li><a class="reference external" href="#the-ssh-client-detects-man-in-the-middle-attacks">The ssh client detects man-in-the-middle attacks</a></li>
<li><a class="reference external" href="#keepalive-from-the-client">Keepalive from the client</a></li>
<li><a class="reference external" href="#ssh-port-forwarding">SSH port forwarding</a><ul>
<li><a class="reference external" href="#quick-howto">Quick howto</a></li>
<li><a class="reference external" href="#going-beyond-the-limitations">Going beyond the limitations</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="packaging.html"
                                  title="previous chapter">debian package and repositories</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="lvm.html"
                                  title="next chapter">lvm</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/ssh.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="lvm.html" title="lvm"
             >next</a> |</li>
        <li class="right" >
          <a href="packaging.html" title="debian package and repositories"
             >previous</a> |</li>
        <li><a href="index.html">fiches v0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2009, Jean Daniel Browne.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.2.
    </div>
  </body>
</html>