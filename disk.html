<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>hard drive &mdash; bits v0.5 documentation</title>
    <link rel="stylesheet" href="static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.5',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="bits v0.5 documentation" href="index.html" />
    <link rel="next" title="phoronix test suite" href="phoronix.html" />
    <link rel="prev" title="tips" href="tips.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="phoronix.html" title="phoronix test suite"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tips.html" title="tips"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">bits v0.5 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="">hard drive</a><ul>
<li><a class="reference external" href="#diagnose-a-bad-hard-drive">Diagnose a bad hard drive</a><ul>
<li><a class="reference external" href="#smartctl">Smartctl</a></li>
<li><a class="reference external" href="#several-kind-of-tests">Several kind of tests</a></li>
<li><a class="reference external" href="#reading-a-test-result">Reading a test result</a></li>
</ul>
</li>
<li><a class="reference external" href="#performances-with-hdparm-and-dd">Performances with hdparm and dd</a></li>
<li><a class="reference external" href="#performance-with-phoronix-disk-test-suite">Performance with Phoronix <em>disk</em> test suite</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="tips.html"
                                  title="previous chapter">tips</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="phoronix.html"
                                  title="next chapter">phoronix test suite</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="sources/disk.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="hard-drive">
<h1>hard drive<a class="headerlink" href="#hard-drive" title="Permalink to this headline">¶</a></h1>
<p>Two interesting questions with hardware elements: Is it working? and
is it performant? A failing hardware will show bad performances,
nevertheless, two functioning hard drives may offer different quality.</p>
<p>For disks, for the first question, there is <em>smartd</em> and <em>badblocks</em>,
for the second question, there is <em>dd</em>, <em>hdparm</em> and the <em>disk</em> test
suite of Phoronix.</p>
<div class="section" id="diagnose-a-bad-hard-drive">
<h2>Diagnose a bad hard drive<a class="headerlink" href="#diagnose-a-bad-hard-drive" title="Permalink to this headline">¶</a></h2>
<p><em>I have a feel that my hard drive died, how to decide if the hard
drive is good for the trash</em></p>
<div class="section" id="smartctl">
<h3>Smartctl<a class="headerlink" href="#smartctl" title="Permalink to this headline">¶</a></h3>
<p><em>SMART</em> is a standard technology which has been implemented into every
hard drive for many years, this technology is used for
example, by the HP rescue boot disk. We are going to query our disk
with the <em>smartctl</em> tool under linux.</p>
</div>
<div class="section" id="several-kind-of-tests">
<h3>Several kind of tests<a class="headerlink" href="#several-kind-of-tests" title="Permalink to this headline">¶</a></h3>
<p>First thing to do: request the disk to activate smart: <tt class="docutils literal"><span class="pre">smartctl</span> <span class="pre">-s</span>
<span class="pre">/dev/sdb</span></tt></p>
<p>Il y a 4 types de tests, les offline, les shorts, les longs et les
conveyance. Ils sont lancés, respectivement avec la commande</p>
<div class="highlight-python"><pre>smartctl -t offline /dev/hda
smartctl -t short /dev/hda
smartctl -t long /dev/hda
smartctl -t conveyance /dev/hda</pre>
</div>
</div>
<div class="section" id="reading-a-test-result">
<h3>Reading a test result<a class="headerlink" href="#reading-a-test-result" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.the-little-things.net/?p=35">http://www.the-little-things.net/?p=35</a></p>
<p>Various parameter can be read :</p>
<p>There are two categories of parameters:</p>
<p>pre-fail</p>
<p>old age</p>
<p>There is another property available for each parameter: either the
value is updated continuously, of the value is updated when a test is
run. Example</p>
<p>smartctl -a /dev/hda affiche un tableau de resultat.</p>
<p>On lit dans la colonne &#8220;updated&#8221; qu&#8217;il y a deux catégorie de
paramètres qui sont updated &#8220;always&#8221; et ceux qui sont updated
&#8220;offline&#8221;. Ceux qui sont &#8220;always&#8221; sont scrutés en permanence. Les
&#8220;offlines&#8221; sont mis a jour grâce au tests.</p>
<p>On lit la valeur du paramètre dans la colonne &#8220;value&#8221; (en %). La
colonne &#8220;worst donne la pire valeur du paramètre depuis la mise en
fonctionnement du disque (ou de l&#8217;activation de SMART?). La colonne
&#8220;threshold&#8221; donne le seuil en dessous duquel le disque est noté comme
failing.</p>
<p>La colonne &#8220;raw_value&#8221; indique la valeur brute avant qu&#8217;elle n&#8217;ait été
ramenée à 100 dans la colonne value. On peut y lire le nombre de
blocks réalloués, la température du disque, la durée pendant laquelle
le disque à été allumé jusqu&#8217;a maintenant ...</p>
<p>Il y a deux types de paramètres, ceux qui donne une indication d&#8217;un
crash imminent ou non (les paramètres notés Pre-fail dans la colonne
&#8220;type&#8221;) et ceux qui dénotent un disque anciens (notés Old_age).</p>
<p>La colonne &#8220;when_failed&#8221; indique si le paramètre est failing en ce
moment ou dans le passé. Si la valeur de la colonne worst est
supérieure à la valeur de la colonne threshold, alors le paramètre n&#8217;a
jamais été failing et la colonne contient un tiret.</p>
<p>Les paramètres Old_age ont un seuil de 0. La valeur de ce paramètre ne
pourra jamais passer sous le seuil ce qui implique qu&#8217;un disque ne
sera jamais &#8220;failing&#8221; a cause d&#8217;un paramètre Old_age. Seuls les
paramètres Pre-fail sont utilisé pour statuer sur le disque. Les
colonnes threshold et when_failed ne sont pas pertinent pour les
paramètres old age.</p>
<p>How to do <em>incremental backups</em>, now? How to <em>ghost the system</em> or
learn how you can make a partition or a <em>device bootable</em>. You may
wish to do RAID1 hotpluggable RAID1 disks.</p>
<p>How to get several kind of smartd tests done regurlarly?? and links
with syslog.</p>
</div>
</div>
<div class="section" id="performances-with-hdparm-and-dd">
<h2>Performances with hdparm and dd<a class="headerlink" href="#performances-with-hdparm-and-dd" title="Permalink to this headline">¶</a></h2>
<p>You can use hdparm (hard disk parameters). It can be used for setting
or querying several parameters such as consumption mode, standby
timeout, drive geometry. With option <cite>-t -T</cite>, we get a performance
test, the output is the read speed in megabyte per seconds. Do the
test three time, on an inactive system, the third result is the more
accurate:</p>
<div class="highlight-python"><pre>lisa # hdparm -t -T /dev/sda
/dev/sda:
 Timing cached reads:   2636 MB in  2.00 seconds = 1319.19 MB/sec
 Timing buffered disk reads:  172 MB in  3.01 seconds =  57.09 MB/sec</pre>
</div>
<p>The simple <tt class="docutils literal"><span class="pre">dd</span></tt> command line tool is also helpful:</p>
<div class="highlight-python"><pre>lisa # dd if=/dev/zero of=toto bs=1024 count=500000
500000+0 records in
500000+0 records out
512000000 bytes (512 MB) copied, 11,5127 s, 44,5 MB/s</pre>
</div>
<p>The results varies between 44.5 and 57 MB per seconds value is good
for a laptop. For a server, performance can be 50 MB/s. On a NAS, we
were having performances problem, hdparm would tell read performance
of only 7MB/s.</p>
</div>
<div class="section" id="performance-with-phoronix-disk-test-suite">
<h2>Performance with Phoronix <em>disk</em> test suite<a class="headerlink" href="#performance-with-phoronix-disk-test-suite" title="Permalink to this headline">¶</a></h2>
<p>Phoronix is heavier to install and longer to run, but is it simple to
do. This page explains how to install and set up Phoronix.</p>
<p>To install the <em>disk</em> test suite:</p>
<div class="highlight-python"><pre>phoronix install disk
# the tests composing the suites are fetched and compiled
# this can take 10 minutes

phoronix batch-run disk
# I got a 684 TPS for pgbench, 140 TPS for PostMark, 25MB/s  for iozone</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="phoronix.html" title="phoronix test suite"
             >next</a> |</li>
        <li class="right" >
          <a href="tips.html" title="tips"
             >previous</a> |</li>
        <li><a href="index.html">bits v0.5 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2009, jdb.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.2.
    </div>
  </body>
</html>